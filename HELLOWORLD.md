

# Hello World !
The purpose of this process is to introduce the creation of a smart contract, to include in a transaction and to save it on the blockchain. Let's create a purchase request on the marketplace.

## Step 0 : setup the network
Start with 3 nodes. The code of this example will be performed on the 3rd node => "127.0.0.3:5000"

## Step 1: initialize default objects

Process to intall and run locally 3 Nodes of the NIG network
* Create a <b>Node object</b> with the default hostname (127.0.0.3:5000).
```bash
  my_node=Node(MY_HOSTNAME)
```
* Create a <b>Owner object</b> for Marketplace  with its the private key.
```bash
  marketplace_owner=Owner(private_key=marketplace_private_key)
```

* Create a <b>Owner object</b> for Daniel  with his the private key.
```bash
  daniel_owner=Owner(private_key=daniel_private_key)
```
* Create a <b>Wallet object</b> for Daniel  with his Owner object and new Node object to send the transaction from that node ("127.0.0.1:5000") to the leader node which will be the 3rd Node ("127.0.0.3:5000").
```bash
  daniel_wallet=Wallet(daniel_owner,Node("127.0.0.1:5000"))
```
* Set the amount of the purchase request : 100€.
```bash
  purchase_request_amount_eur=100
```
* Define the smart contract address. In this example, we will use a fake address.
```bash
  smart_contract_account="hello_world"
```
## Step 2: get the default payload for a marketplace request
* This payload will be used to query an existing contract and get the default payload for a marketplace request 
```bash
  payload="""
memory_obj_2_load=['marketplace_request_code']
return marketplace_request_code.code
"""
```
* The following parameters are used to setup the contract transaction.
	* <i>smart_contract_type</i> = API as we're just querying the smart contract and not adding information on it via SOURCE.
	* <i>smart_contract_public_key_hash</i> = MARKETPLACE_CODE_PUBLIC_KEY_HASH this is the address ('41e69d07d38a4d7cca36df456ef099e8efb0512d') of the smart contract. 
	*<i>sender_public_key_hash</i> = a default value. It should be the address of the account which is query the smart contract.
	*<i>payload</i> = the payload will be sent to query the smart contract.
```bash
  smart_contract_data = {
        'smart_contract_type': 'api',
        'smart_contract_public_key_hash': MARKETPLACE_CODE_PUBLIC_KEY_HASH,
        'sender_public_key_hash': 'sender_public_key_hash',
        'payload':payload,
      }
```
* The function <i>smart_contract</i> of <i>my_mode</i> with the dictionary <i>smart_contract_data</i> as input will launch a http request. The default payload for a marketplace request will be available by querying with the key <i>'smart_contract_result'</i> the dictionary generated by the HTTP response.
```bash
  smart_contract_value=my_node.smart_contract(smart_contract_data).json()
  marketplace_request_default_code=smart_contract_value['smart_contract_result']
```
## Step 3: generate the payload for the purchase request
* The below python script is using the Class <i>MarketplaceRequest</i> of the default payload for a marketplace request for generating a purchase request on the marketplace.
```bash
  marketplace_script="""
mp_request_step2_done=MarketplaceRequest()
mp_request_step2_done.step1("mp_request_step2_done",requester_public_key_hash,requester_public_key_hex,requested_amount,smart_contract_ref,new_user_flag,reputation_0,reputation_1)
mp_request_step2_done.account=sender
memory_list.add([mp_request_step2_done,mp_request_step2_done.mp_request_name,['account','step','timestamp','requested_amount',
  'requested_currency','requested_deposit','buyer_public_key_hash','timestamp_step1','timestamp_step2','timestamp_step3','timestamp_step4',
  'buyer_public_key_hex','requested_nig','timestamp_nig','seller_public_key_hex','seller_public_key_hash','encrypted_account','buyer_reput_trans','buyer_reput_reliability',
  'mp_request_signature','mp_request_id','previous_mp_request_name','mp_request_name','seller_safety_coef','smart_contract_ref','new_user_flag','reputation_buyer','reputation_seller']])
mp_request_step2_done.get_requested_deposit()

"""
```
* Several parameters are needed to configure the previous script. This payload is added on top of the previous payload.
	* <i>requester_public_key_hash</i> = the address (public key hash) of the account which is making the purchase request.
	* <i>requester_public_key_hex</i> = the public key hex of the account which is making the purchase. It will be used to send the bank account details of the seller to this buyer.
	* <i>smart_contract_ref</i> = the address of the smart contract.
	*  <i>new_user_flag</i> = True as it's a new user on the NIG network.
	* <i>reputation_0</i> and <i>reputation_1</i>= 0 as it's a new user.
```bash
  parameters=f'''requester_public_key_hash="{daniel_owner.public_key_hash}"
requester_public_key_hex="{daniel_owner.public_key_hex}"
requested_amount={purchase_request_amount_eur}
smart_contract_ref="{smart_contract_account}"
new_user_flag=True
reputation_0=0
reputation_1=1
'''+marketplace_script
```
* This final payload is the concatenation of the default payload <i>marketplace_request_default_code</i> for a marketplace request and the payload <i>parameters</i>that we have just generated.
```bash
  payload=marketplace_request_default_code+parameters
```
## Step 4: retrieve the utxo of the marketplace
* The endpoint/url <i>"utxo"</i> of a node with <i>address of the marketplace</i> as a parameter needs to be queried in order to get the available <i>utxo</i> of the marketplace.
```bash
  public_key_hash=marketplace_owner.public_key_hash
  utxo_url='http://'+MY_HOSTNAME+'/utxo/'+public_key_hash
  resp = requests.get(utxo_url)
  utxo_dict = resp.json()
```
## Step 5: launch the creation of a purchase request
* Several parameters are needed for configuring the transactions.
	* <i>sender_public_key_hash</i> = the address (public key hash) of the account which is purchasing.
	* <i>unlocking_public_key_hash</i> = the address (public key hash) of the account which is purchasing which is used to unlock the transaction/utxo.
	*  <i>list_public_key_hash</i> = list of the addresses all the accounts which can interact with that smart contract : the smart contract itself, the buyer and the marketplace.
	* <i>account_temp</i> = True default value for a purchase request.
	* <i>marketplace_step</i> = 0 default value for a purchase request.
	* <i>input_list</i> = [] default list of the inputs of the transaction.
	* <i>output_list</i> = [] default list of the outputs of the transaction.
```bash
  sender_public_key_hash=daniel_owner.public_key_hash
  unlocking_public_key_hash=daniel_owner.public_key_hash
  list_public_key_hash=[smart_contract_account,sender_public_key_hash,marketplace_owner.public_key_hash]
  account_temp=True
  marketplace_step=0
  input_list=[]
  output_list=[]
```
* Loop over the available <i>utxo</i> of the marketplace. We will use only the first one.
```bash
  for utxo in utxo_dict['utxos']:
```
* The amount of the utxo is retrived. The smart contract is configured using <i>SmartContract</i> class.
	* <i>smart_contract_account</i> = the address (public key hash) of the smart contract.
	* <i>smart_contract_sender</i> = the address (public key hash) of the account which is generating the smart contract.
	* <i>payload</i> = the payload used to generate the smart contract.
	* <i>smart_contract_new</i> = True as we're creating a new contract.
```bash
  amount=utxo['amount']
  smart_contract=SmartContract(smart_contract_account,
                               smart_contract_sender=sender_public_key_hash,
                               smart_contract_type="source",
                               payload=payload,
                               smart_contract_new=True)
```
* Let's process the smart contract to ensure that it's working fine.
```bash
  smart_contract.process()
```
* Let's populate the inputs of the transaction.
```bash
  input_list.append(TransactionInput(transaction_hash=utxo['transaction_hash'], output_index=utxo['output_index'],unlocking_public_key_hash=unlocking_public_key_hash))
```
* Let's populate the outputs of the transaction thanks to the smart contract object previously generated.
```bash
  output_list.append(TransactionOutput(list_public_key_hash=list_public_key_hash, 
                                                amount=amount,
                                                interface_public_key_hash=interface_public_key_hash,
                                                smart_contract_account=smart_contract.smart_contract_account,
                                                smart_contract_sender=smart_contract.smart_contract_sender,
                                                smart_contract_new=smart_contract.smart_contract_new,
                                                smart_contract_flag=True,
                                                account_temp=account_temp,
                                                marketplace_step=marketplace_step,
                                                marketplace_transaction_flag=True,
                                                smart_contract_gas=smart_contract.gas,
                                                smart_contract_memory=smart_contract.smart_contract_memory,
                                                smart_contract_memory_size=smart_contract.smart_contract_memory_size,
                                                smart_contract_type=smart_contract.smart_contract_type,
                                                smart_contract_payload=smart_contract.payload,
                                                smart_contract_result=smart_contract.result,
                                                smart_contract_previous_transaction=smart_contract.smart_contract_previous_transaction,
                                                smart_contract_transaction_hash=smart_contract.smart_contract_transaction_hash))
```
* Let's process the transaction by using the function.<i>process_transaction</i> of the wallet of Daniel.
```bash
  daniel_wallet.process_transaction(inputs=input_list, outputs=output_list)
```
* We're using only one utxo of marketplace, so let's break the loop.
```bash
  break
```
## Step 6: Check the results
* The purchase request should be available with the below url:
```bash
  http://127.0.0.3:5000/marketplace_step/1/test
```
* The code of the purchase request can be found directly in the blockchain by using this url:
```bash
  http://127.0.0.3:5000/block
```
## Congratulations, you did it !

## Code
A complete and functional python script of this [HELLO WORLD example](src/common/HELLOWORLD.py) is available. This code can be tested directly by accessing the URL <i>helloworld</i> of a node (ex: http://127.0.0.3:5000/helloworld)
## Feedback

If you have any feedback, please reach out to us at cryptomonnaie.nig@gmail.com
